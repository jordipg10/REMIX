module m_binarysolutionphase
!-------------------------------------------------------------------------
!
!   $Description: This class represents a mineral phase with ideal 
! thermodynamic behavior
!
!   $Use:
!
!   $Author: Sergio Andrés Bea Jofré
!
!   $License:
!
!-------------------------------------------------------------------------
!%-------------------------------------------------------------------------
!% Modules corresponding to CHEPROO project
!%-------------------------------------------------------------------------
use m_parentphase
use m_general_tools_cheproo
use m_constants_cheproo
!%-------------------------------------------------------------------------
!% Modules corresponding to xml parser 
!%-------------------------------------------------------------------------
use flib_xpath
use flib_sax
!%----------------------------------------------------------------
!%----------------------------------------------------------------
private ::
!%----------------------------------------------------------------
!%----------------------------------------------------------------
public:: &
create_ &
,destroy_ &
,compute_act_coeff_ &
,compute_dact_coeff_ &
,update_ &
,set_ &
,set_pparent_ &
,write_ 
!%---------------------------------------------------------------
!% Type definition 
!%---------------------------------------------------------------
type, public::t_binarysolutionphase
 
private ::
 
type (t_parentphase), pointer   :: pp    ! Parent phase 

real*8                          :: a0

real*8                          :: a1
 
end type t_binarysolutionphase
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface create_
 
module procedure create_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface destroy_
 
module procedure destroy_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface set_
 
module procedure set_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface set_pparent_
 
module procedure set_pparent_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface compute_act_coeff_
 
module procedure compute_act_coeff_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface compute_dact_coeff_
 
module procedure compute_dact_coeff_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface update_
 
module procedure update_temp_param_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface write_
 
module procedure write_binsolph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------ 
contains
!%************************************************************
!%***************Public subroutines***************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine create_binsolph &
   (this)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(inout) :: this

!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------

logical                              :: &
iserror 

!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
this%pp => null ()
this%a0=0.0d0
this%a1=0.0d0
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutines***************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine destroy_binsolph &
   (this)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(inout) :: this 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
this%pp => null ()
this%a0=0.0d0
this%a1=0.0d0
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutines***************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine set_binsolph &
   (this, &
    pp, &
	iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(inout)   :: this

type(t_parentphase), intent(in), target :: pp

logical, intent(out)                    :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
integer        :: &
 i 
!-------------------------------------------------------------------------
!
!   $code
!
!%------------------------------------------------------------ 
iserror=.false. 
!%------------------------------------------------------------
this%pp => pp 
!%------------------------------------------------------------
!% Update according reference temperature
!%------------------------------------------------------------
call update_ (this,this%pp%tempref,iserror)
if (iserror) goto 10
!%------------------------------------------------------------
return
10 continue
iserror=.true. 
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine write_binsolph &
   (this, &
    ioutput, &
    iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(in)      :: this

integer, intent(in)                          :: ioutput 

logical, intent(out)                         :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
iserror=.false.
write (ioutput,*) '------------------------------------'
write (ioutput,*) '          Mineral Phase             '
write (ioutput,*) '      Activity model: Binary solution        '
!%-----------------------------------------------------------
!% Write the parent phase 
!%-----------------------------------------------------------
call write_ (this%pp,ioutput,iserror)
!%-----------------------------------------------------------
write (ioutput,*) '------------------------------------'
!%-----------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine set_pparent_binsolph &
   (this, &
    pp)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(inout)   :: this

type(t_parentphase), intent(in), target :: pp
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
this%pp => pp
!%------------------------------------------------------------
 
return
end subroutine
!%************************************************************
!%***************Public subroutines***************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine update_temp_param_binsolph &
   (this, &
    temp, &
    iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(inout) :: this

real*8, intent(in)                         :: temp

logical, intent(out)                       :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
iserror=.false.
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutines***************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine compute_act_coeff_binsolph &
   (this, &
    g, &
    c)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(in)      :: this

real*8, pointer, dimension(:)                :: g

real*8, intent(in), dimension(this%pp%numsp) :: c
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
!%----------------------------------------------------------
call check_pointer_ (g,this%pp%numsp,.true.)
!%----------------------------------------------------------
g = 1.0
!%----------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutines***************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine compute_dact_coeff_binsolph &
   (this, &
    dg, &
    c, &
    dc, &
    g, &
    dparam)

implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_binarysolutionphase), intent(in)                   :: this

real*8, intent(in), dimension(this%pp%numsp)              :: c

real*8, intent(in), dimension(:,:)                        :: dc

real*8, pointer, dimension(:,:)                           :: dg

real*8, intent(in), optional, dimension(this%pp%numsp)    :: g

real*8, pointer, optional, dimension(:)                   :: dparam

!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
logical                :: &
 havedparam, &
 haveg
integer                :: &
 ndim 
!-------------------------------------------------------------------------
!
!   $code
!
havedparam = present (dparam)
haveg = present (g)
!%----------------------------------------------------------
ndim=size(dc,2)
call check_pointer_ (dg,this%pp%numsp,ndim,.true.)
!%---------------------------------------------------------
return
end subroutine
!%**********************************************************
!%**********************************************************
!%**********************************************************
end module m_binarysolutionphase
