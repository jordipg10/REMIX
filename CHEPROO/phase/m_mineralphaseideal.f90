module m_mineralidealphase
!-------------------------------------------------------------------------
!
!   $Description: This class represents a mineral phase with ideal 
! thermodynamic behavior
!
!   $Use:
!
!   $Author: Sergio Andrés Bea Jofré
!
!   $License:
!
!-------------------------------------------------------------------------
!%-------------------------------------------------------------------------
!% Modules corresponding to CHEPROO project
!%-------------------------------------------------------------------------
use m_parentphase
use m_general_tools_cheproo
use m_constants_cheproo
!%-------------------------------------------------------------------------
!% Modules corresponding to xml parser 
!%-------------------------------------------------------------------------
use flib_xpath
use flib_sax
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
private            ::
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
public             :: &
create_ &
,set_ &
,set_pparent_ &
,destroy_ &
,compute_act_coeff_ &
,compute_dact_coeff_ &
,update_ &
,write_ &
,assignment(=)
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
type, public::t_mineralidealphase
 
type (t_parentphase), pointer   :: pp   ! Parent phase 
 
end type t_mineralidealphase
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface create_
 
module procedure create_minidealph
 
end interface
!%------------------------------------------------------------------------
!%------------------------------------------------------------------------
interface destroy_
 
module procedure destroy_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface set_
 
module procedure set_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface set_pparent_
 
module procedure set_pparent_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface compute_act_coeff_
 
module procedure compute_act_coeff_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface compute_dact_coeff_
 
module procedure compute_dact_coeff_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface update_
 
module procedure update_temp_param_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface write_
 
module procedure write_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
interface assignment(=)
 
module procedure copy_minidealph
 
end interface
!%-------------------------------------------------------------------
!%-------------------------------------------------------------------
contains
!%------------------------------------------------------------------------
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine create_minidealph &
   (this)
implicit none
!-------------------------------------------------------------------------
!
!   $Description: Create idela mineral phase object 
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(inout) :: this 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
this%pp => null ()
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine destroy_minidealph &
   (this)
implicit none
!-------------------------------------------------------------------------
!
!   $Description: Destroy ideal mineral phase 
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(inout) :: this 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
this%pp => null ()
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine set_minidealph &
   (this, &
    pp, &
	iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(inout):: this

type(T_ParentPhase), intent(in), target :: pp 

logical, intent(out)                    :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 
iserror=.false. 
!%------------------------------------------------------------
this%pp => pp 
!%------------------------------------------------------------
!% Update according reference temperature
!%------------------------------------------------------------
call update_ (this,this%pp%tempref,iserror)
if (iserror) goto 10
!%------------------------------------------------------------
return
10 continue
iserror=.true. 
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine set_pparent_minidealph &
   (this, &
    pp)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(inout) :: this
type(T_ParentPhase), pointer             :: pp 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
this%pp => pp
!%------------------------------------------------------------
 
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine update_temp_param_minidealph &
   (this, &
    temp, &
    iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description: Update temperature dependent-parameters in the ideal mineral phase. 
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(inout)      :: this

real*8, intent(in)                            :: temp

logical, intent(out)                          :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
 iserror=.false.
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine write_minidealph &
   (this, &
    ioutput, &
    iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(in) :: this

integer, intent(in)                   :: ioutput 

logical, intent(out)                  :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 

!%------------------------------------------------------------
iserror=.false.
write (ioutput,*) '************************************'
write (ioutput,*) '          Mineral Phase             '
write (ioutput,*) '      Activity model: Ideal         '
!%-----------------------------------------------------------
call write_ (this%pp,ioutput,iserror)
!%-----------------------------------------------------------
write (ioutput,*) '************************************'
!%-----------------------------------------------------------
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine compute_act_coeff_minidealph &
   (this, &
    g, &
    c, &
	iserror)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(in)   :: this

real*8, pointer                         :: g(:)

real*8, intent(in)                      :: c(this%pp%numsp) 

logical, intent(out)                    :: iserror 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
character(len=100)                      :: &
msg 
!-------------------------------------------------------------------------
!
!   $code
!
iserror=.false. 
msg=''
!%------------------------------------------------------------
call check_pointer_ (g,this%pp%numsp,.true.)
!%------------------------------------------------------------
g = 1.0d0
!%------------------------------------------------------------
return
10 continue 
print *,'*******************************'
print *,'Phase:'
print *,'Name:', this%pp%name
print *,'Service: compute_act_coeff_'
print *, msg
print *,'*******************************'
iserror=.true.
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
subroutine compute_dact_coeff_minidealph &
   (this, &
    dg, &
    c, &
    dc, &
	iserror, &
    g,&
    dparam)
implicit none
!-------------------------------------------------------------------------
!
!   $Description:
!
!   $Arguments:
!
 
 
type(t_mineralidealphase), intent(in) :: this

real*8, intent(in)             :: c(this%pp%numsp)

real*8, intent(in)             :: dc(:,:)

real*8,pointer                 :: dg(:,:)

real*8, intent(in), optional   :: g(this%pp%numsp)

real*8, pointer, optional      :: dparam(:) 

logical, intent(out)           :: iserror 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
logical                  :: &
 havedparam, &
 haveg
integer                  :: &
 ndim 
character(len=100)       :: &
 msg
!-------------------------------------------------------------------------
!
!   $code
!
iserror=.false.
msg='' 
!%------------------------------------------------------------
havedparam=present(dparam)
haveg=present(g)
!%------------------------------------------------------------
ndim=size(dc,2)
!%------------------------------------------------------------
call check_pointer_ (dg,this%pp%numsp,ndim,.true.)
!%------------------------------------------------------------
if (havedparam) then
  call check_pointer_ (dparam,ndim,.true.)
end if
!%------------------------------------------------------------
return
10 continue 
print *,'*******************************'
print *,'Phase:'
print *,'Name:', this%pp%name
print *,'Service: compute_dct_coeff_'
print *, msg
print *,'*******************************'
iserror=.true.
return
end subroutine
!%************************************************************
!%***************Public subroutine****************************
!%************************************************************
!%************************************************************
!%************************************************************
subroutine copy_minidealph &
  (copied, &
   this)
implicit none
!-------------------------------------------------------------------------
!
!   $Description: Copy a object in other species object.  
!
!   $Arguments:
!
 
type(t_mineralidealphase), intent(in) :: this

type(t_mineralidealphase), intent(out):: copied 
 
!-------------------------------------------------------------------------
!
!   $Pre-cond:
!
!   $Post-cond:
!
!   $License:
!
!-------------------------------------------------------------------------
 
!-------------------------------------------------------------------------
!
!   $code
!
 
 

!%------------------------------------------------------------
copied%pp => null ()
!%------------------------------------------------------------
return
end subroutine
!%************************************************************
!%************************************************************
!%************************************************************
!%************************************************************
!%************************************************************
!%************************************************************
!%************************************************************
!%************************************************************
end module m_mineralidealphase
